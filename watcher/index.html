
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://erwindouna.github.io/pyportainer/watcher/">
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../listener/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>Image Update Watcher - pyportainer</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#image-update-watcher" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="pyportainer" class="md-header__button md-logo" aria-label="pyportainer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pyportainer
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Image Update Watcher
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/erwindouna/pyportainer" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  Image Update Watcher

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../listener/" class="md-tabs__link">
        
  
  
    
  
  Event Listener

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../api/reference/" class="md-tabs__link">
        
  
  
    
  
  API Reference

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="pyportainer" class="md-nav__button md-logo" aria-label="pyportainer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    pyportainer
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/erwindouna/pyportainer" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Image Update Watcher
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Image Update Watcher
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How it works
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic usage
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#watching-a-specific-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        Watching a specific endpoint
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#results" class="md-nav__link">
    <span class="md-ellipsis">
      
        Results
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Callbacks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Callbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registering-a-callback" class="md-nav__link">
    <span class="md-ellipsis">
      
        Registering a callback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Async callbacks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filtering-for-updates-only" class="md-nav__link">
    <span class="md-ellipsis">
      
        Filtering for updates only
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unregistering-a-callback" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unregistering a callback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#runtime-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Runtime control
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Runtime control">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#changing-the-interval" class="md-nav__link">
    <span class="md-ellipsis">
      
        Changing the interval
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-when-the-last-poll-ran" class="md-nav__link">
    <span class="md-ellipsis">
      
        Checking when the last poll ran
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stopping-the-watcher" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stopping the watcher
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        API reference
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyportainer.watcher" class="md-nav__link">
    <span class="md-ellipsis">
      
        watcher
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher" class="md-nav__link">
    <span class="md-ellipsis">
      
        PortainerImageWatcher
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PortainerImageWatcher">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher.interval" class="md-nav__link">
    <span class="md-ellipsis">
      
        interval
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher.last_check" class="md-nav__link">
    <span class="md-ellipsis">
      
        last_check
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher.results" class="md-nav__link">
    <span class="md-ellipsis">
      
        results
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher.register_callback" class="md-nav__link">
    <span class="md-ellipsis">
      
        register_callback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher.start" class="md-nav__link">
    <span class="md-ellipsis">
      
        start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher.stop" class="md-nav__link">
    <span class="md-ellipsis">
      
        stop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher.unregister_callback" class="md-nav__link">
    <span class="md-ellipsis">
      
        unregister_callback
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcherResult" class="md-nav__link">
    <span class="md-ellipsis">
      
        PortainerImageWatcherResult
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../listener/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event Listener
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How it works
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic usage
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#watching-a-specific-endpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        Watching a specific endpoint
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#results" class="md-nav__link">
    <span class="md-ellipsis">
      
        Results
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Callbacks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Callbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registering-a-callback" class="md-nav__link">
    <span class="md-ellipsis">
      
        Registering a callback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#async-callbacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Async callbacks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filtering-for-updates-only" class="md-nav__link">
    <span class="md-ellipsis">
      
        Filtering for updates only
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unregistering-a-callback" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unregistering a callback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#runtime-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Runtime control
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Runtime control">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#changing-the-interval" class="md-nav__link">
    <span class="md-ellipsis">
      
        Changing the interval
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-when-the-last-poll-ran" class="md-nav__link">
    <span class="md-ellipsis">
      
        Checking when the last poll ran
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stopping-the-watcher" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stopping the watcher
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        API reference
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyportainer.watcher" class="md-nav__link">
    <span class="md-ellipsis">
      
        watcher
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher" class="md-nav__link">
    <span class="md-ellipsis">
      
        PortainerImageWatcher
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PortainerImageWatcher">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher.interval" class="md-nav__link">
    <span class="md-ellipsis">
      
        interval
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher.last_check" class="md-nav__link">
    <span class="md-ellipsis">
      
        last_check
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher.results" class="md-nav__link">
    <span class="md-ellipsis">
      
        results
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher.register_callback" class="md-nav__link">
    <span class="md-ellipsis">
      
        register_callback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher.start" class="md-nav__link">
    <span class="md-ellipsis">
      
        start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher.stop" class="md-nav__link">
    <span class="md-ellipsis">
      
        stop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcher.unregister_callback" class="md-nav__link">
    <span class="md-ellipsis">
      
        unregister_callback
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pyportainer.watcher.PortainerImageWatcherResult" class="md-nav__link">
    <span class="md-ellipsis">
      
        PortainerImageWatcherResult
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="image-update-watcher">Image Update Watcher</h1>
<p><code>pyportainer</code> comes with a built-in background watcher: <code>PortainerImageWatcher</code>. The watcher can continuously monitor your running Docker containers for available image updates.</p>
<p>It polls Portainer at a configurable interval, compares the local image digest of each running container against the digest in the registry, and stores the results so your application can react to available updates without blocking.</p>
<h2 id="how-it-works">How it works</h2>
<ol>
<li>On <code>start()</code>, a background asyncio task is created.</li>
<li>The first check runs immediately, then repeats after each configured <code>interval</code>.</li>
<li>For every endpoint (or a specific one), the watcher fetches all running containers, deduplicates by image, and concurrently calls <code>container_image_status()</code> for each unique image.</li>
<li>Results are stored internally and exposed via <code>watcher.results</code>.</li>
<li>Errors for individual containers or endpoints are logged but never stop the polling loop.</li>
</ol>
<h2 id="installation">Installation</h2>
<p>No extra dependencies are needed, the watcher is part of the core <code>pyportainer</code> package and runs on <code>asyncio</code>.</p>
<h2 id="basic-usage">Basic usage</h2>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">timedelta</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyportainer</span><span class="w"> </span><span class="kn">import</span> <span class="n">Portainer</span><span class="p">,</span> <span class="n">PortainerImageWatcher</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">Portainer</span><span class="p">(</span>
        <span class="n">api_url</span><span class="o">=</span><span class="s2">&quot;http://localhost:9000&quot;</span><span class="p">,</span>
        <span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;YOUR_API_KEY&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">portainer</span><span class="p">:</span>
        <span class="n">watcher</span> <span class="o">=</span> <span class="n">PortainerImageWatcher</span><span class="p">(</span>
            <span class="n">portainer</span><span class="p">,</span>
            <span class="n">interval</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">watcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Depending on the registires it may take some time for the first check to complete</span>
        <span class="c1"># So we wait a bit before accessing results</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">endpoint_id</span><span class="p">,</span> <span class="n">container_id</span><span class="p">),</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">watcher</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">update_available</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Update available for container </span><span class="si">{</span><span class="n">container_id</span><span class="si">}</span><span class="s2"> on endpoint </span><span class="si">{</span><span class="n">endpoint_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">watcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>
<h2 id="watching-a-specific-endpoint">Watching a specific endpoint</h2>
<p>Pass <code>endpoint_id</code> to limit monitoring to a single Portainer endpoint:</p>
<div class="highlight"><pre><span></span><code><span class="n">watcher</span> <span class="o">=</span> <span class="n">PortainerImageWatcher</span><span class="p">(</span>
    <span class="n">portainer</span><span class="p">,</span>
    <span class="n">endpoint_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">interval</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">12</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="configuration">Configuration</h2>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>portainer</code></td>
<td><code>Portainer</code></td>
<td>â€”</td>
<td>The Portainer client instance</td>
</tr>
<tr>
<td><code>endpoint_id</code></td>
<td><code>int \| None</code></td>
<td><code>None</code></td>
<td>Endpoint to monitor. <code>None</code> watches all endpoints</td>
</tr>
<tr>
<td><code>interval</code></td>
<td><code>timedelta</code></td>
<td>12 hours</td>
<td>How often to poll for updates</td>
</tr>
<tr>
<td><code>debug</code></td>
<td><code>bool</code></td>
<td><code>False</code></td>
<td>Enable debug-level logging</td>
</tr>
</tbody>
</table>
<h2 id="results">Results</h2>
<p><code>watcher.results</code> returns a copy of the current results as a dictionary:</p>
<div class="highlight"><pre><span></span><code>dict[(endpoint_id, container_id), PortainerImageWatcherResult]
</code></pre></div>
<p>Each <code>PortainerImageWatcherResult</code> contains:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>endpoint_id</code></td>
<td><code>int \| None</code></td>
<td>The endpoint the container belongs to</td>
</tr>
<tr>
<td><code>container_id</code></td>
<td><code>str \| None</code></td>
<td>The container ID</td>
</tr>
<tr>
<td><code>status</code></td>
<td><code>PortainerImageUpdateStatus \| None</code></td>
<td>The image update check result</td>
</tr>
</tbody>
</table>
<p><code>PortainerImageUpdateStatus</code> fields:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>update_available</code></td>
<td><code>bool</code></td>
<td><code>True</code> if a newer image is available in the registry</td>
</tr>
<tr>
<td><code>local_digest</code></td>
<td><code>str \| None</code></td>
<td>Digest of the locally running image</td>
</tr>
<tr>
<td><code>registry_digest</code></td>
<td><code>str \| None</code></td>
<td>Digest of the latest image in the registry</td>
</tr>
</tbody>
</table>
<h2 id="callbacks">Callbacks</h2>
<p>Instead of polling <code>watcher.results</code> yourself, you can register callbacks that are invoked automatically after each poll cycle, once per container result. Both sync and async callables are supported.</p>
<h3 id="registering-a-callback">Registering a callback</h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pyportainer</span><span class="w"> </span><span class="kn">import</span> <span class="n">Portainer</span><span class="p">,</span> <span class="n">PortainerImageWatcher</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyportainer.watcher</span><span class="w"> </span><span class="kn">import</span> <span class="n">PortainerImageWatcherResult</span>


<span class="k">def</span><span class="w"> </span><span class="nf">on_result</span><span class="p">(</span><span class="n">result</span><span class="p">:</span> <span class="n">PortainerImageWatcherResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">update_available</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Update available for container </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">container_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">watcher</span> <span class="o">=</span> <span class="n">PortainerImageWatcher</span><span class="p">(</span><span class="n">portainer</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
<span class="n">watcher</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">on_result</span><span class="p">)</span>
<span class="n">watcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div>
<h3 id="async-callbacks">Async callbacks</h3>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">on_result</span><span class="p">(</span><span class="n">result</span><span class="p">:</span> <span class="n">PortainerImageWatcherResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">update_available</span><span class="p">:</span>
        <span class="c1"># Follow up with an async action, e.g. send a notification</span>
        <span class="k">await</span> <span class="n">notify</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">container_id</span><span class="p">)</span>

<span class="n">watcher</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">on_result</span><span class="p">)</span>
</code></pre></div>
<h3 id="filtering-for-updates-only">Filtering for updates only</h3>
<p>Callbacks receive every result, including containers where no update is available. Filter inside the callback:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">on_result</span><span class="p">(</span><span class="n">result</span><span class="p">:</span> <span class="n">PortainerImageWatcherResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">update_available</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="c1"># Handle update ...</span>
</code></pre></div>
<h3 id="unregistering-a-callback">Unregistering a callback</h3>
<div class="highlight"><pre><span></span><code><span class="n">watcher</span><span class="o">.</span><span class="n">unregister_callback</span><span class="p">(</span><span class="n">on_result</span><span class="p">)</span>
</code></pre></div>
<h3 id="notes">Notes</h3>
<ul>
<li>Registering the same callable twice is a no-go; it will only be called once per result.</li>
<li>Exceptions raised inside a callback are logged but do not stop the watcher or prevent other callbacks from running.</li>
<li>The <code>WatcherCallback</code> type alias is exported from <code>pyportainer</code> for type annotations: <code>from pyportainer import WatcherCallback</code>.</li>
</ul>
<h2 id="runtime-control">Runtime control</h2>
<h3 id="changing-the-interval">Changing the interval</h3>
<p>The polling interval can be updated at any time. The new value takes effect after the next completed check:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">timedelta</span>

<span class="n">watcher</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<p>It is however recommended to not thunderherd the registry with too frequent checks, especially if you have many containers or endpoints. A reasonable interval is usually between 6 and 24 hours, depending on how often you update your images.
Registries may rate-limit requests, so adjust accordingly if you have many containers or a registry with strict limits.</p>
<h3 id="checking-when-the-last-poll-ran">Checking when the last poll ran</h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="k">if</span> <span class="n">watcher</span><span class="o">.</span><span class="n">last_check</span><span class="p">:</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">watcher</span><span class="o">.</span><span class="n">last_check</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last checked at: </span><span class="si">{</span><span class="n">last</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="stopping-the-watcher">Stopping the watcher</h3>
<div class="highlight"><pre><span></span><code><span class="n">watcher</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div>
<p>Calling <code>stop()</code> cancels the background task. Call <code>start()</code> again to restart it.</p>
<h2 id="api-reference">API reference</h2>


<div class="doc doc-object doc-module">



<a id="pyportainer.watcher"></a>
    <div class="doc doc-contents first">

        <p>Background image update watcher.</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="pyportainer.watcher.PortainerImageWatcher" class="doc doc-heading">
            <code>PortainerImageWatcher</code>


</h2>


    <div class="doc doc-contents ">



        <p>Periodically checks all containers on an endpoint for image updates.</p>
<p>Results are stored and accessible via the <code>results</code> property after each check.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/pyportainer/watcher.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PortainerImageWatcher</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Periodically checks all containers on an endpoint for image updates.</span>

<span class="sd">    Results are stored and accessible via the `results` property after each check.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">portainer</span><span class="p">:</span> <span class="n">Portainer</span><span class="p">,</span>
        <span class="n">endpoint_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">interval</span><span class="p">:</span> <span class="n">timedelta</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">12</span><span class="p">),</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the PortainerImageWatcher.</span>

<span class="sd">        Args:</span>
<span class="sd">        ----</span>
<span class="sd">            portainer: An authenticated Portainer client instance.</span>
<span class="sd">            endpoint_id: The ID of the endpoint whose containers to monitor. If None, all endpoints are monitored.</span>
<span class="sd">            interval: How often to poll for updates. Defaults to 12 hours.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_portainer</span> <span class="o">=</span> <span class="n">portainer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_endpoint_id</span> <span class="o">=</span> <span class="n">endpoint_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interval</span> <span class="o">=</span> <span class="n">interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">PortainerImageWatcherResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_task</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Task</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_check</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">WatcherCallback</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">_LOGGER</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">interval</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">timedelta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Polling interval.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interval</span>

    <span class="nd">@interval</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the polling interval. Takes effect after the next check.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interval</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">last_check</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Timestamp of the last completed check, or None if no checks have completed yet.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_check</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">PortainerImageWatcherResult</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Latest update status as of the last check.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the background polling loop.</span>

<span class="sd">        The first check runs immediately; subsequent checks run after each interval.</span>
<span class="sd">        Must be called from within a running asyncio event loop.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cancel the background polling loop.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">register_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">WatcherCallback</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a callback to be invoked for every result after each poll cycle.</span>

<span class="sd">        Both synchronous and async callables are supported. The callback receives a</span>
<span class="sd">        single :class:`PortainerImageWatcherResult` argument. Each unique callable</span>
<span class="sd">        is only registered once; duplicate registrations are silently ignored.</span>

<span class="sd">        Args:</span>
<span class="sd">        ----</span>
<span class="sd">            callback: A sync or async callable that accepts a</span>
<span class="sd">                :class:`PortainerImageWatcherResult`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">callback</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">unregister_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">WatcherCallback</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a previously registered callback.</span>

<span class="sd">        Args:</span>
<span class="sd">        ----</span>
<span class="sd">            callback: The callable to remove. Raises :exc:`ValueError` if it was not registered.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_fire_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">PortainerImageWatcherResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Invoke all registered callbacks for a single result.</span>

<span class="sd">        Exceptions raised by individual callbacks are logged but not blocking.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">callback</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">callback</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutine</span><span class="p">(</span><span class="n">ret</span><span class="p">):</span>
                    <span class="k">await</span> <span class="n">ret</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
                <span class="n">_LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Callback raised an exception for container </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">container_id</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loop that checks immediately, then sleep for the interval, then repeat.</span>

<span class="sd">        Errors during checks are logged but don&#39;t stop the watcher, allowing recovery from transient issues.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_all</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">PortainerTimeoutError</span><span class="p">:</span>
                <span class="n">_LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Timeout during image check&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">PortainerConnectionError</span><span class="p">:</span>
                <span class="n">_LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Connection error during image check&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">PortainerAuthenticationError</span><span class="p">:</span>
                <span class="n">_LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Authentication error during image check&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">PortainerError</span><span class="p">:</span>
                <span class="n">_LOGGER</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error during image check&quot;</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_last_check</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_interval</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_check_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch all containers and check each unique image concurrently.</span>

<span class="sd">        Errors for individual images are logged but silently skipped so one</span>
<span class="sd">        failing image does not prevent the rest from being checked.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoint_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">endpoint_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_endpoint_id</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No endpoint_id specified, fetching all endpoints to check.&quot;</span><span class="p">)</span>
            <span class="n">endpoints</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_portainer</span><span class="o">.</span><span class="n">get_endpoints</span><span class="p">()</span>
            <span class="n">endpoint_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">endpoint</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">endpoints</span><span class="p">]</span>

        <span class="n">fresh</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">PortainerImageWatcherResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">endpoint_id</span> <span class="ow">in</span> <span class="n">endpoint_ids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">containers</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_portainer</span><span class="o">.</span><span class="n">get_containers</span><span class="p">(</span><span class="n">endpoint_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">PortainerError</span><span class="p">:</span>
                <span class="n">_LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to fetch containers for endpoint </span><span class="si">%s</span><span class="s2">, skipping&quot;</span><span class="p">,</span> <span class="n">endpoint_id</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">image_containers</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">containers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">container</span><span class="o">.</span><span class="n">image</span> <span class="ow">and</span> <span class="n">container</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;running&quot;</span><span class="p">:</span>
                    <span class="n">image_containers</span><span class="p">[</span><span class="n">container</span><span class="o">.</span><span class="n">image</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

            <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Checking </span><span class="si">%d</span><span class="s2"> unique images for endpoint </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_containers</span><span class="p">),</span> <span class="n">endpoint_id</span><span class="p">)</span>

            <span class="n">statuses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
                <span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_portainer</span><span class="o">.</span><span class="n">container_image_status</span><span class="p">(</span><span class="n">endpoint_id</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span> <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">image_containers</span><span class="p">),</span>
                <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">image</span><span class="p">,</span> <span class="n">status</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">image_containers</span><span class="p">,</span> <span class="n">statuses</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="ne">BaseException</span><span class="p">):</span>
                    <span class="n">_LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to check image </span><span class="si">%s</span><span class="s2"> on endpoint </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">endpoint_id</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">container_id</span> <span class="ow">in</span> <span class="n">image_containers</span><span class="p">[</span><span class="n">image</span><span class="p">]:</span>
                    <span class="n">fresh</span><span class="p">[(</span><span class="n">endpoint_id</span><span class="p">,</span> <span class="n">container_id</span><span class="p">)]</span> <span class="o">=</span> <span class="n">PortainerImageWatcherResult</span><span class="p">(</span>
                        <span class="n">endpoint_id</span><span class="o">=</span><span class="n">endpoint_id</span><span class="p">,</span>
                        <span class="n">container_id</span><span class="o">=</span><span class="n">container_id</span><span class="p">,</span>
                        <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="n">_LOGGER</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Checked image </span><span class="si">%s</span><span class="s2"> on endpoint </span><span class="si">%s</span><span class="s2"> for container </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">endpoint_id</span><span class="p">,</span> <span class="n">container_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span> <span class="o">=</span> <span class="n">fresh</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span> <span class="ow">and</span> <span class="n">fresh</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fire_callbacks</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">fresh</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="pyportainer.watcher.PortainerImageWatcher.interval" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">interval</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Polling interval.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="pyportainer.watcher.PortainerImageWatcher.last_check" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">last_check</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Timestamp of the last completed check, or None if no checks have completed yet.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="pyportainer.watcher.PortainerImageWatcher.results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">results</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Latest update status as of the last check.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="pyportainer.watcher.PortainerImageWatcher.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">portainer</span><span class="p">,</span> <span class="n">endpoint_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">12</span><span class="p">),</span> <span class="o">*</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the PortainerImageWatcher.</p>
        <hr />
<pre><code>portainer: An authenticated Portainer client instance.
endpoint_id: The ID of the endpoint whose containers to monitor. If None, all endpoints are monitored.
interval: How often to poll for updates. Defaults to 12 hours.
</code></pre>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyportainer/watcher.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">portainer</span><span class="p">:</span> <span class="n">Portainer</span><span class="p">,</span>
    <span class="n">endpoint_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">interval</span><span class="p">:</span> <span class="n">timedelta</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">12</span><span class="p">),</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the PortainerImageWatcher.</span>

<span class="sd">    Args:</span>
<span class="sd">    ----</span>
<span class="sd">        portainer: An authenticated Portainer client instance.</span>
<span class="sd">        endpoint_id: The ID of the endpoint whose containers to monitor. If None, all endpoints are monitored.</span>
<span class="sd">        interval: How often to poll for updates. Defaults to 12 hours.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_portainer</span> <span class="o">=</span> <span class="n">portainer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_endpoint_id</span> <span class="o">=</span> <span class="n">endpoint_id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_interval</span> <span class="o">=</span> <span class="n">interval</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">PortainerImageWatcherResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_task</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Task</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_last_check</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">WatcherCallback</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">_LOGGER</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span> <span class="k">if</span> <span class="n">debug</span> <span class="k">else</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyportainer.watcher.PortainerImageWatcher.register_callback" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_callback</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Register a callback to be invoked for every result after each poll cycle.</p>
<p>Both synchronous and async callables are supported. The callback receives a
single :class:<code>PortainerImageWatcherResult</code> argument. Each unique callable
is only registered once; duplicate registrations are silently ignored.</p>
        <hr />
<pre><code>callback: A sync or async callable that accepts a
    :class:`PortainerImageWatcherResult`.
</code></pre>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyportainer/watcher.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">register_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">WatcherCallback</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Register a callback to be invoked for every result after each poll cycle.</span>

<span class="sd">    Both synchronous and async callables are supported. The callback receives a</span>
<span class="sd">    single :class:`PortainerImageWatcherResult` argument. Each unique callable</span>
<span class="sd">    is only registered once; duplicate registrations are silently ignored.</span>

<span class="sd">    Args:</span>
<span class="sd">    ----</span>
<span class="sd">        callback: A sync or async callable that accepts a</span>
<span class="sd">            :class:`PortainerImageWatcherResult`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">callback</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyportainer.watcher.PortainerImageWatcher.start" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Start the background polling loop.</p>
<p>The first check runs immediately; subsequent checks run after each interval.
Must be called from within a running asyncio event loop.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyportainer/watcher.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Start the background polling loop.</span>

<span class="sd">    The first check runs immediately; subsequent checks run after each interval.</span>
<span class="sd">    Must be called from within a running asyncio event loop.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyportainer.watcher.PortainerImageWatcher.stop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stop</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Cancel the background polling loop.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyportainer/watcher.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cancel the background polling loop.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyportainer.watcher.PortainerImageWatcher.unregister_callback" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unregister_callback</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Remove a previously registered callback.</p>
        <hr />
<pre><code>callback: The callable to remove. Raises :exc:`ValueError` if it was not registered.
</code></pre>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/pyportainer/watcher.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">unregister_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">:</span> <span class="n">WatcherCallback</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a previously registered callback.</span>

<span class="sd">    Args:</span>
<span class="sd">    ----</span>
<span class="sd">        callback: The callable to remove. Raises :exc:`ValueError` if it was not registered.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pyportainer.watcher.PortainerImageWatcherResult" class="doc doc-heading">
            <code>PortainerImageWatcherResult</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



        <p>Represents the status of an image watcher.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/pyportainer/watcher.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PortainerImageWatcherResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents the status of an image watcher.&quot;&quot;&quot;</span>

    <span class="n">endpoint_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">container_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">PortainerImageUpdateStatus</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Home">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Home
              </div>
            </div>
          </a>
        
        
          
          <a href="../listener/" class="md-footer__link md-footer__link--next" aria-label="Next: Event Listener">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Event Listener
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright Â© 2025 Erwin Douna
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/erwindouna" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/erwindouna/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tabs", "navigation.top", "navigation.footer", "navigation.expand", "navigation.sections", "navigation.instant", "navigation.tracking", "navigation.search.highlight", "navigation.search.suggest", "navigation.search.share"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>